import os
import json
import re

def find_hash_code(text):
    # Generic hash code regex (matches MD5, SHA-1, and SHA-256)
    hash_regex = re.compile(r'\b(?:[a-fA-F\d]{32}|[a-fA-F\d]{40}|[a-fA-F\d]{64})\b')

    # Find all hash codes in the text
    hash_codes = re.findall(hash_regex, text)
    return hash_codes

def search_in_cve_files(root_folder, hash_code, vcs_platform):
    for root, dirs, files in os.walk(root_folder):
        for file in files:
            if file.endswith('.json') and file.startswith('CVE-'):
                file_path = os.path.join(root, file)
                print(f"Processing file: {file_path}")
                with open(file_path, 'r') as json_file:
                    try:
                        cve_data = json.load(json_file)
                        references = cve_data.get('references', [])
                        for reference in references:
                            if find_hash_code(reference) and re.search(vcs_platform, reference, re.IGNORECASE):
                                print(f"Found in {file_path}: {reference}")
                    except json.JSONDecodeError:
                        print(f"Error decoding JSON in {file_path}")

# Example usage
base_folder = '/Users/faisal/Documents/bachelor-prosjekt'
cve_folder = os.path.join(base_folder, 'cves')
vcs_platform_to_search = 'github'

search_in_cve_files(cve_folder, '', vcs_platform_to_search)

